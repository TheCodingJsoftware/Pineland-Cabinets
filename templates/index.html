<!doctype html>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.2/js/bootstrap.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.4/js/bootstrap-select.js"></script>
<script src="https://www.kryogenix.org/code/browser/sorttable/sorttable.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
<script src="https://circletype.labwire.ca/dist/circletype.min.js"></script>
<script src="jquery.fittext.js"></script>
<head>
    <link rel="icon" href="/static/favicon.png">
    <link type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.2/css/bootstrap.css"
        rel="stylesheet" />
    <link type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.4/css/bootstrap-select.css"
        rel="stylesheet" />
    <link type="text/css" rel="stylesheet" href='/static/main.css' />

    <meta property="og:title" content="Pineland Cabinets" />
    <meta property="og:url" content="http://pinelandcabinets.hbni.net:5040" />
    <meta property="og:description" content="Pineland Colony Cabinetry." />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <header>
        <div class="background">
            <div class="header-overlay">
            </div>
    </header>
    <div class="center">
        <h3 id="arch">Specializing in Cabinets, Furniture, Wood working, and much more.</h3>
    </div>
    <div class="toolbar mb2 mt2">
        {% for folder, folder_data in folders.items() %}
        <button class="btn fil-cat" data-rel={{folder}}>{{folder_data}}</button>
        {% endfor %}
    </div>
    <br>

    <div class="scroll">
        <div id="portfolio" class="image-grid">
            {% for folder, folder_data in pictures.items() %}
            {% for picture in folder_data %}
            <div class="tile scale-anm web {{folder}}">
                <a target="_blank" href="{{ url_for('static', filename=picture) }}">
                    <img rel="preload" data-src="{{ url_for('static', filename=picture) }}" class='image' alt="Loading..." loading="lazy">
                </a>
            </div>
            {% endfor %}
            {% endfor %}
        </div>
    </div>

    <div style="clear:both;"></div>

</head>
<br>
<br>

<footer>
    <div class="footer-container">
        <h4>Pineland Cabinets</h4>
    </div>
    <div class="address">Email: <a href="mailto:joseph@pinelandfarms.ca">joseph@pinelandfarms.ca</a></div>
    <br>
    Cell: (204) 229 7793
    <br>
    Piney MB
    <br>
    <br>
    <div class="footer-bottom">
        Copyright 2022 by Pineland Colony
    </div>
</footer>

<script>
    $(document).ready(function () {
        new CircleType(document.getElementById('arch')).radius(4400);
        $("#arch").fitText();
    })
    $(function () {
        var selectedClass = "";
        $(".fil-cat").click(function () {
            selectedClass = $(this).attr("data-rel");
            $("#portfolio").fadeTo(100, 0.1);
            $("#portfolio div").not("." + selectedClass).fadeOut().removeClass('scale-anm');
            setTimeout(function () {
                $("." + selectedClass).fadeIn().addClass('scale-anm');
                $("#portfolio").fadeTo(300, 1);
            }, 300);

        });
    });
    document.addEventListener("DOMContentLoaded", async function() {
        const portfolio = document.getElementById("portfolio");

        // Fetch image data from Flask asynchronously
        const response = await fetch("/get_images");
        const pictures = await response.json();

        // Create an IntersectionObserver for lazy loading
        const observer = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const img = entry.target;
                    if (img.dataset.src) {
                        img.src = img.dataset.src;  // Set actual src to load image
                        observer.unobserve(img);
                    }
                }
            });
        }, { rootMargin: "0px 0px 200px 0px" });

        // Populate the portfolio container with images from the JSON response
        for (const [folder, folderImages] of Object.entries(pictures)) {
            folderImages.forEach(picture => {
                const tile = document.createElement("div");
                tile.className = `tile scale-anm web ${folder}`;

                const link = document.createElement("a");
                link.href = `/static/${picture}`;
                link.target = "_blank";

                const img = document.createElement("img");
                img.dataset.src = `/static/${picture}`;  // Use data-src for lazy loading
                img.className = "image";
                img.alt = picture;
                img.loading = "lazy";

                link.appendChild(img);
                tile.appendChild(link);
                portfolio.appendChild(tile);

                observer.observe(img);  // Observe each image for lazy loading
            });
        }
    });

</script>